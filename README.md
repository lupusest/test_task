# Content Management API

Это Django-проект, реализующий API для управления страницами и связанным с ними полиморфным контентом. Проект полностью контейнеризован с помощью Docker и Docker Compose и готов к запуску одной командой.

## Особенности реализации

- **Архитектура моделей**: Используется наследование моделей (Multi-table Inheritance) для легкой расширяемости типов контента (Видео, Аудио и т.д.).
- **API**: Реализовано на Django REST Framework с пагинацией и вложенной сериализацией для связанных объектов.
- **Фоновые задачи**: Увеличение счетчиков просмотров выполняется асинхронно с помощью Celery и Redis, чтобы не замедлять ответы API.
- **Атомарность**: Обновление счетчиков в БД происходит атомарно с использованием `F()` выражений Django.
- **Админ-панель**: Удобное управление контентом на странице с помощью inline-блоков и drag-and-drop сортировки.
- **Автоматизация**: Процесс миграции, сбора статики и наполнения базы тестовыми данными полностью автоматизирован при первом запуске.

## Стек технологий

- **Backend**: Python 3.9, Django, Django REST Framework
- **Веб-сервер**: Nginx (в качестве обратного прокси)
- **База данных**: MariaDB
- **Фоновые задачи**: Celery, Redis
- **Контейнеризация**: Docker, Docker Compose

## Быстрый старт

### Требования

- Docker
- Docker Compose

### Установка и запуск

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <your-repo-url>
    cd <project-folder-name>
    ```

2.  **Настройте переменные окружения:**
    Скопируйте файл с примером. Для локального запуска менять ничего не нужно. Если вы будете обращаться к серверу по IP-адресу из другой машины в сети, добавьте этот IP в `ALLOWED_HOSTS`.
    ```bash
    cp .env.example .env
    ```

3.  **Запустите проект:**
    Эта команда соберет все необходимые образы и запустит все сервисы. При первом запуске скрипт `entrypoint.sh` автоматически выполнит миграции, соберет статику и наполнит базу 15-ю тестовыми страницами. Также будет создан пользователь-администратор.
    ```bash
    docker compose up --build -d
    ```

**Проект готов к работе!**

-   **Админ-панель**: [http://localhost:8000/admin/](http://localhost:8000/admin/)
    -   **Логин:** `admin`
    -   **Пароль:** `admin`
-   **API (список страниц)**: [http://localhost:8000/api/v1/pages/](http://localhost:8000/api/v1/pages/)
-   **Документация API (Swagger)**: [http://localhost:8000/swagger/](http://localhost:8000/swagger/)
-   **Демо-интерфейс**: [http://localhost:8000/index.html](http://localhost:8000/index.html)

## Запуск тестов

Для проверки корректности работы API можно запустить автоматические тесты.

**Команда для запуска тестов:**
```bash
docker compose exec web python manage.py test --keepdb -v 2
```
